var NelioABAltTable={lastId:0,alts:[],init:function(f){var c=NelioABAltTable.getTable().find("tr").last();c.hide();c.addClass("template");c.addClass("deleted");NelioABAltTable.alts=f;for(var d=0;d<f.length;++d){var b=f[d];if(b.id<NelioABAltTable.id){NelioABAltTable.id=b.id}}var e=jQuery("#alt-table");e.on("new-form-shown",function(j,h){NelioABAdminTable.hideInlineEdit(e);var a=h.prev();var g=a.find(".alt-name").text();h.find("#qe_alt_name").attr("value",g);h.find("label").removeClass("error");h.find(".save").addClass("disabled");NelioABEditExperiment.manageProgress(false,false)});e.on("new-form-hidden",function(g,a){if(NelioABEditExperiment.validateCurrentTab()){NelioABEditExperiment.manageProgress(true,true)}});e.on("inline-edit-shown",function(j,h){NelioABAltTable.hideNewAltForm(e);var a=h.prev();var g=a.find(".alt-name").text();h.find("#qe_alt_name").attr("value",g);h.find("label").removeClass("error");h.find(".save").addClass("disabled");NelioABEditExperiment.manageProgress(false,false)});e.on("inline-edit-hidden",function(h,g){var a=NelioABEditExperiment.validateCurrentTab();NelioABEditExperiment.manageProgress(a[0],a[1])});jQuery(document).on("save-experiment",function(){NelioABAltTable.save()});e.find(".nelioab-quick-edit-row .button.save").on("clicked",function(){NelioABAltTable.saveQuickEdit()});jQuery("#qe_alt_name").on("keyup focusout",function(){var g=jQuery(this).closest("tr").prev();var a=jQuery("#qe_alt_name").attr("value").trim();NelioABAltTable.validateName(g.data("alt-id"),a)});jQuery("#new_alt_name").on("keyup focusout",function(){var g=jQuery(this).closest("tr").prev();var a=jQuery("#new_alt_name").attr("value").trim();NelioABAltTable.validateName(0,a)});jQuery(document).on("tab-changed",function(g,a){if(a=="tab-alts"){NelioABEditExperiment.validateCurrentTab=NelioABAltTable.validate}});e.on("row-removed",function(){var a=NelioABEditExperiment.validateCurrentTab();NelioABEditExperiment.manageProgress(a[0],a[1])})},getTable:function(){var a=jQuery("#the-list");if(a.length>0){return jQuery("#the-list")}else{return false}},getAltById:function(b){var a=NelioABAltTable.alts;for(i=0;i<a.length;++i){if(a[i].id==b){return a[i]}}return false},create:function(){var c=NelioABAltTable.getTable();var a=jQuery("#new_alt_name").attr("value");var e=jQuery("#based_on").attr("value");if(!NelioABAltTable.validateName(0,a)){return}--NelioABAltTable.lastId;var d={id:NelioABAltTable.lastId,isNew:true,name:a,base:e,wasDeleted:false,};NelioABAltTable.alts.push(d);var b=NelioABAltTable.createRow(NelioABAltTable.lastId);b.find(".row-title").first().text(a);NelioABAltTable.hideNewAltForm(NelioABAltTable.getTable());b.show();NelioABAdminTable.repaint(NelioABAltTable.getTable())},createRow:function(c){var b=NelioABAltTable.getTable();var a=b.find("tr.template").first().clone();a.removeClass("template");a.removeClass("deleted");a.data("alt-id",c);b.append(a);return a},editContent:function(a){var b=a.data("alt-id");jQuery("#content_to_edit").attr("value",b);NelioABEditExperiment.save("edit_alt_content")},remove:function(b){b.addClass("deleted");b.css("display","none");NelioABAdminTable.repaint(NelioABAltTable.getTable());var a=NelioABAltTable.getAltById(b.data("alt-id"));a.wasDeleted=true;b.closest("table").trigger("row-removed",[b])},showNewPageOrPostAltForm:function(b,d){if(d){var a=b.find("#based_on");var c=NelioABPostSearcher.getInfo(jQuery("#exp_original"));NelioABPostSearcher.doSetDefault(a,c);b.find(".new-alt-form .copying-content").show()}else{b.find(".new-alt-form .copying-content").hide();b.find("#based_on").attr("value",-1)}b.find(".new-alt-form").show();if(b.find("#qe_alt_name").attr("value").trim()==0){b.find(".new-alt-form .button.save").addClass("disabled")}b.trigger("new-form-shown",[b.find(".new-alt-form")])},hideNewAltForm:function(a){a.find(".new-alt-form").hide();a.find("#new_alt_name").attr("value","");a.trigger("new-form-hidden",[a.find(".new-alt-form")])},rename:function(){var b=jQuery("#alt-table .nelioab-quick-edit-row");if(b.find("a.button-primary").hasClass("disabled")){return}var d=b.prev();var a=jQuery("#qe_alt_name").attr("value").trim();var c=NelioABAltTable.getAltById(d.data("alt-id"));c.name=a.trim();c.isDirty=true;d.find(".row-title").first().text(a)},validate:function(){var a=true;var b=true;if(jQuery("#alt-table .nelioab-quick-edit-row").css("display")!="none"){a=b=false}if(jQuery("#alt-table .new-alt-form").css("display")!="none"){a=b=false}if(!NelioABAltTable.validateNumOfAlternatives()){b=false}return[a,b]},validateNumOfAlternatives:function(){var c=0;for(var d=0;d<NelioABAltTable.alts.length;++d){var b=NelioABAltTable.alts[d];if(!b.wasDeleted){++c}}if(c==0){return false}return true},validateName:function(b,a){a=a.trim();var g=true;if(a.length<=0){g=false}var h=NelioABAltTable.getTable().find("tr:not(.deleted)");for(var c=1;c<h.length&&g;++c){var j=h.eq(c);var d=j.data("alt-id");if(d==undefined||j.data("alt-id")==b){continue}if(j.find(".alt-name").text()==a){g=false}}var e=jQuery("#alt-table .nelioab-quick-edit-row");var f=jQuery("#alt-table .new-alt-form");if(!g){jQuery("#qe_alt_name").closest("label").addClass("error");e.find(".button.save").addClass("disabled");jQuery("#new_alt_name").closest("label").addClass("error");f.find(".button.save").addClass("disabled")}else{jQuery("#qe_alt_name").closest("label").removeClass("error");e.find(".save").removeClass("disabled");jQuery("#new_alt_name").closest("label").removeClass("error");f.find(".button.save").removeClass("disabled")}return g},saveQuickEdit:function(){NelioABAltTable.rename()},save:function(){jQuery("#nelioab_alternatives").attr("value",encodeURIComponent(JSON.stringify(NelioABAltTable.alts)).replace(/'/g,"%27"))},};