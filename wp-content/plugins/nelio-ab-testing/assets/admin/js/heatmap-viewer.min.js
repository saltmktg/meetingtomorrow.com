var nelioab__phone={max:-1,data:[]};var nelioab__tablet={max:-1,data:[]};var nelioab__desktop={max:-1,data:[]};var nelioab__hd={max:-1,data:[]};var nelioab__phone_click={max:-1,data:[]};var nelioab__tablet_click={max:-1,data:[]};var nelioab__desktop_click={max:-1,data:[]};var nelioab__hd_click={max:-1,data:[]};var nelioab__nodata={max:0,data:[]};var nelioab__show_clicks=false;var nelioab__current_type="desktop";var nelioabHeatmapScale=0.75;var nelioabHoveringDevice=null;var nelioabSwitchToClickEnabled=true;jQuery(document).ready(function(){jQuery("#view-clicks").click(function(){if(!nelioabSwitchToClickEnabled){return}nelioabSwitchToClickEnabled=false;nelioab__show_clicks=!nelioab__show_clicks;if(nelioab__show_clicks){jQuery("#view-clicks").text(NelioABHeatmapLabels.hm.view)}else{jQuery("#view-clicks").text(NelioABHeatmapLabels.cm.view)}highlightData(nelioab__show_clicks);switchHeatmap()});jQuery("#devices a").each(function(){jQuery(this).mouseenter(function(){nelioabHoveringDevice=jQuery(this);var d=jQuery(this).attr("data-viewport").split("x");var b=d[0],e=d[1],a=b,c=e;if(b!="auto"){a=Math.ceil(b*nelioabHeatmapScale),c=Math.ceil(e*nelioabHeatmapScale)}jQuery("#phantom").width(a);jQuery("#phantom").height(c);jQuery("#phantom").css("margin-left",-(a/2))});jQuery(this).mouseleave(function(){jQuery("#phantom").width(0);jQuery("#phantom").height(0);jQuery("#phantom").css("margin-left",0)});jQuery(this).click(function(){nelioab__current_type=jQuery(this).attr("id");switchHeatmap();jQuery("#devices .active").each(function(){jQuery(this).removeClass("active")});var a=jQuery(this).attr("data-viewport").split("x");scaleTo(a[0],a[1],nelioabHeatmapScale);jQuery(this).addClass("active")})})});function scaleTo(b,d,e){var a=b,c=d;if(b!="auto"){a=Math.ceil(b*e),c=Math.ceil(d*e)}if(b=="auto"){jQuery("#wrapper > iframe").css("width","100%");jQuery("#wrapper > iframe").css("height","100%");jQuery("#wrapper > iframe").removeClass("scaled");jQuery("#wrapper").css("width","100%");jQuery("#wrapper").css("height","100%");jQuery("#wrapper").css("margin-top","0px")}else{jQuery("#wrapper > iframe").css("width",b);jQuery("#wrapper > iframe").css("height",d);jQuery("#wrapper > iframe").addClass("scaled");jQuery("#wrapper").css("width",a);jQuery("#wrapper").css("height",c);jQuery("#wrapper").css("margin-top","25px")}}function highlightData(a){var b;if(a){b=NelioABHeatmapLabels.cm}else{b=NelioABHeatmapLabels.hm}if(a){if(nelioab__pre_phone_click.max>0){jQuery("#mobile").attr("title",b.phone).removeClass("disabled")}else{jQuery("#mobile").attr("title",b.phoneNo).addClass("disabled")}}else{if(nelioab__pre_phone.max>0){jQuery("#mobile").attr("title",b.phone).removeClass("disabled")}else{jQuery("#mobile").attr("title",b.phoneNo).addClass("disabled")}}if(a){if(nelioab__pre_tablet_click.max>0){jQuery("#tablet").attr("title",b.tablet).removeClass("disabled")}else{jQuery("#tablet").attr("title",b.tabletNo).addClass("disabled")}}else{if(nelioab__pre_tablet.max>0){jQuery("#tablet").attr("title",b.tablet).removeClass("disabled")}else{jQuery("#tablet").attr("title",b.tabletNo).addClass("disabled")}}if(a){if(nelioab__pre_desktop_click.max>0){jQuery("#desktop").attr("title",b.desktop).removeClass("disabled")}else{jQuery("#desktop").attr("title",b.desktopNo).addClass("disabled")}}else{if(nelioab__pre_desktop.max>0){jQuery("#desktop").attr("title",b.desktop).removeClass("disabled")}else{jQuery("#desktop").attr("title",b.desktopNo).addClass("disabled")}}if(a){if(nelioab__pre_hd_click.max>0){jQuery("#hd").attr("title",b.hd).removeClass("disabled")}else{jQuery("#hd").attr("title",b.hdNo).addClass("disabled")}}else{if(nelioab__pre_hd.max>0){jQuery("#hd").attr("title",b.hd).removeClass("disabled")}else{jQuery("#hd").attr("title",b.hdNo).addClass("disabled")}}}function switchHeatmap(){document.getElementById("content").contentWindow.clearHeatmapObject();jQuery("#builder").show();setTimeout("buildAndSwitchHeatmap()",400)}function buildAndSwitchHeatmap(){switch(nelioab__current_type){case"mobile":if(!nelioab__show_clicks){buildHeatmap(nelioab__pre_phone,nelioab__phone)}else{buildHeatmap(nelioab__pre_phone_click,nelioab__phone_click)}break;case"tablet":if(!nelioab__show_clicks){buildHeatmap(nelioab__pre_tablet,nelioab__tablet)}else{buildHeatmap(nelioab__pre_tablet_click,nelioab__tablet_click)}break;case"desktop":if(!nelioab__show_clicks){buildHeatmap(nelioab__pre_desktop,nelioab__desktop)}else{buildHeatmap(nelioab__pre_desktop_click,nelioab__desktop_click)}break;case"hd":if(!nelioab__show_clicks){buildHeatmap(nelioab__pre_hd,nelioab__hd)}else{buildHeatmap(nelioab__pre_hd_click,nelioab__hd_click)}break;default:}}jQuery(document).on("heatmap-built",function(){var e;var c="#"+nelioab__current_type;var b=jQuery(c).attr("data-viewport").split("x");var a=b[0],d=b[1];switch(nelioab__current_type){case"mobile":e=document.getElementById("content").contentWindow.createHeatmapObject(a,d);jQuery("#builder").fadeOut();if(nelioab__show_clicks){jQuery("#visitors-count").html(nelioab__pre_phone_click.views);e.store.setDataSet(nelioab__phone_click)}else{jQuery("#visitors-count").html(nelioab__pre_phone.views);e.store.setDataSet(nelioab__phone)}break;case"tablet":e=document.getElementById("content").contentWindow.createHeatmapObject(a,d);jQuery("#builder").fadeOut();if(nelioab__show_clicks){jQuery("#visitors-count").html(nelioab__pre_tablet_click.views);e.store.setDataSet(nelioab__tablet_click)}else{jQuery("#visitors-count").html(nelioab__pre_tablet.views);e.store.setDataSet(nelioab__tablet)}break;case"desktop":e=document.getElementById("content").contentWindow.createHeatmapObject(a,d);jQuery("#builder").fadeOut();if(nelioab__show_clicks){jQuery("#visitors-count").html(nelioab__pre_desktop_click.views);e.store.setDataSet(nelioab__desktop_click)}else{jQuery("#visitors-count").html(nelioab__pre_desktop.views);e.store.setDataSet(nelioab__desktop)}break;case"hd":e=document.getElementById("content").contentWindow.createHeatmapObject(a,d);jQuery("#builder").fadeOut();if(nelioab__show_clicks){jQuery("#visitors-count").html(nelioab__pre_hd_click.views);e.store.setDataSet(nelioab__hd_click)}else{jQuery("#visitors-count").html(nelioab__pre_hd.views);e.store.setDataSet(nelioab__hd)}break;default:e=document.getElementById("content").contentWindow.createHeatmapObject();e.store.setDataSet(nelioab__nodata)}nelioabSwitchToClickEnabled=true});function maxAcceptableValue(a){var h=[];var k=0;var g=0;var b=999999;var e=0;for(var j in a.data){h.push(a.data[j].max);e+=a.data[j].max}h=h.sort(function(m,l){return l-m});k=Math.floor(e/h.length);g=h[Math.floor(h.length/2)];var c=0;var f=Math.floor(h.length*0.01);while(k>g*1.6&&c<f){var i=h.length-(c+1);e-=h[c];k=Math.floor(e/i);b=h[c+1];c++}var d=b*2;if(h.length>0&&d>h[0]){d=h[0]}return{maxAcceptableValue:b,maxValue:d}}function buildHeatmap(c,b){if(b.max==-1){var a=function(){doBuildHeatmap(c,b);jQuery(document).unbind("nelioab-scroll-done",a)};jQuery(document).on("nelioab-scroll-done",a);document.getElementById("content").contentWindow.nelioabLoadScrollableElements()}else{jQuery(document).trigger("heatmap-built")}}function doBuildHeatmap(f,l){l.max=0;var C=[];var c=maxAcceptableValue(f);var g=c.maxValue;var a=c.maxAcceptableValue;var n=Math.floor(a*0.2);if(g==a){a--}for(var o in f.data){var d=f.data[o];var B;try{B=jQuery(o,document.getElementById("content").contentWindow.document)}catch(A){continue}var z=B.css("padding-left");if(z==undefined){z="0"}var r=B.css("padding-right");if(r==undefined){r="0"}var q=B.css("padding-top");if(q==undefined){q="0"}var b=B.css("padding-bottom");if(b==undefined){b="0"}z=Math.round(z.replace(/[^0-9\.]/g,""));r=Math.round(r.replace(/[^0-9\.]/g,""));q=Math.round(q.replace(/[^0-9\.]/g,""));b=Math.round(b.replace(/[^0-9\.]/g,""));if(!B.is(":visible")){continue}var m=B.width()+z+r;var v=B.height()+q+b;var u=Math.round(B.offset().left)-z;var t=Math.round(B.offset().top)-q;for(var s=0;s<d.data.length;++s){var D=d.data[s];var p=D.count;if(p>a){p=Math.floor((p-a)/(g-a))*n+a}var k=u+Math.round(m*D.x);var j=t+Math.round(v*D.y);if(!isNaN(k)&&!isNaN(j)){count=addPointCount(C,k,j,p);if(p>l.max){l.max=p}}}}l.data=C;jQuery(document).trigger("heatmap-built")}function addPointCount(g,a,h,e){var b=0;var f=false;var d;for(var c=0;c<g.length;++c){var d=g[c];if(d.x==a&&d.y==h){d.count+=e;b=d.count;f=true;break}}if(!f){d={x:a,y:h,count:e};b=d.count;g.push(d)}return b};